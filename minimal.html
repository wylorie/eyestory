<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Minimal EyeStory Test</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="bg">
    <canvas id="bgCanvas" aria-hidden="true"></canvas>
  </div>

  <main class="app" role="main">
    <header class="app__header">
      <div class="brand">
        <span class="brand__icon" aria-hidden="true">üëÅÔ∏è</span>
        <h1 class="brand__title">EyeStory</h1>
      </div>
      <p class="tagline">Create rich stories using only your eyes and blinks.</p>
      <div class="controls" role="toolbar" aria-label="Primary controls">
        <button id="btnStart" class="btn btn--primary" data-gazeable="true">Start Eye Tracking</button>
        <button id="btnRefresh" class="btn" data-gazeable="true">New Words</button>
      </div>
      <div class="status" aria-live="polite">
        <div><strong>Eye Tracking:</strong> <span id="statusTracking">Inactive</span></div>
        <div><strong>Blink Detection:</strong> <span id="statusBlink">Calibrating‚Ä¶</span></div>
        <div><strong>Selected:</strong> <span id="statusSelected">0/3</span></div>
      </div>
    </header>

    <section class="words" aria-labelledby="wordsTitle">
      <h2 id="wordsTitle" class="section__title">Look at a word and blink to select (need 3)</h2>
      <div id="wordGrid" class="word-grid" role="list"></div>
      <div class="selected" aria-live="polite">
        <h3 class="selected__title">Selected Words</h3>
        <div id="selectedList" class="selected__chips" role="list"></div>
      </div>
    </section>
  </main>

  <script>
    console.log('Minimal script starting...');
    
    // Basic word functionality without external libraries
    const WORD_BANK = [
      'alien','philosophical','gadget','science','astronomy','nebula','quantum','voyage','time','memory','cosmic','signal','horizon','myth','machine','dream','ocean','forest','ruins','android','empathy','gravity','satellite','orbit','comet','asteroid','lunar','martian','plasma','fractals','entropy','language','echo','whisper','labyrinth','symphony','artifact','chronicle','nocturnal','bioluminescent','equation','paradox','singularity','nanotech','portal','renaissance','utopia','dystopia','serendipity','constellation','aurora','cipher','archive','pilgrim','oracle','monolith','wyrm','phoenix','storm','mirage'
    ];
    
    let currentWords = [];
    let selectedWords = [];
    
    const wordGrid = document.getElementById('wordGrid');
    const selectedList = document.getElementById('selectedList');
    const statusSelected = document.getElementById('statusSelected');
    const btnRefresh = document.getElementById('btnRefresh');
    
    console.log('DOM elements found:', {
      wordGrid: !!wordGrid,
      selectedList: !!selectedList,
      statusSelected: !!statusSelected,
      btnRefresh: !!btnRefresh
    });
    
    function shuffle(array) {
      for(let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    function pickWords(count) {
      return shuffle([...WORD_BANK]).slice(0, count);
    }
    
    function renderGrid() {
      console.log('renderGrid called');
      if (!wordGrid) {
        console.error('wordGrid element not found!');
        return;
      }
      wordGrid.innerHTML = '';
      console.log('Rendering', currentWords.length, 'words');
      console.log('currentWords:', currentWords);
      
      currentWords.forEach(w => {
        const tile = document.createElement('button');
        tile.className = 'word-tile';
        tile.type = 'button';
        tile.textContent = w;
        tile.setAttribute('role', 'listitem');
        tile.setAttribute('data-gazeable', 'true');
        tile.setAttribute('aria-selected', 'false');
        tile.addEventListener('click', () => {
          console.log('Word clicked:', w);
          selectWord(w, tile);
        });
        wordGrid.appendChild(tile);
      });
      
      // Add refresh tile
      const refreshTile = document.createElement('button');
      refreshTile.id = 'wordRefreshTile';
      refreshTile.className = 'word-tile';
      refreshTile.type = 'button';
      refreshTile.textContent = 'New Words';
      refreshTile.setAttribute('role', 'listitem');
      refreshTile.setAttribute('data-gazeable', 'true');
      refreshTile.addEventListener('click', refreshWords);
      wordGrid.appendChild(refreshTile);
      
      console.log('Grid rendered with', wordGrid.children.length, 'elements');
    }
    
    function renderSelected() {
      if (!selectedList || !statusSelected) return;
      
      selectedList.innerHTML = '';
      selectedWords.forEach(w => {
        const chip = document.createElement('div');
        chip.className = 'chip';
        chip.textContent = w;
        selectedList.appendChild(chip);
      });
      statusSelected.textContent = `${selectedWords.length}/3`;
    }
    
    function selectWord(word, tile) {
      if (selectedWords.includes(word)) return;
      if (selectedWords.length >= 3) return;
      
      selectedWords.push(word);
      tile.setAttribute('aria-selected', 'true');
      console.log('Selected words:', selectedWords.length, selectedWords);
      renderSelected();
    }
    
    function refreshWords() {
      console.log('refreshWords called');
      selectedWords = [];
      currentWords = pickWords(18);
      console.log('Generated words:', currentWords);
      renderGrid();
      renderSelected();
    }
    
    // Initialize
    btnRefresh.addEventListener('click', refreshWords);
    
    // Start with words
    refreshWords();
    
    console.log('Minimal script completed');
  </script>
</body>
</html>
